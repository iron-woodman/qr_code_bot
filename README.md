# Telegram Бот для Генерации и Чтения QR-кодов

Этот проект представляет собой простого Telegram-бота, который генерирует QR-коды на основе предоставленных пользователем URL-адресов, а также умеет распознавать QR-коды на изображениях. Бот разработан с использованием библиотеки `aiogram` для асинхронной работы с Telegram Bot API.

## Функционал

- **Генерация QR-кода из URL и текста:** Пользователь отправляет боту URL-адрес или любой текст, и бот преобразует его в QR-код.
- **Чтение QR-кода с изображения:** Пользователь отправляет боту изображение с QR-кодом, и бот распознает его, возвращая содержащийся текст.
- **Проверка подписки:** Перед использованием бота пользователь должен быть подписан на указанный в настройках канал.
- **Выбор темы:** При генерации QR-кода пользователь может выбрать одну из двух тем:
  - **Светлая:** Черный QR-код на белом фоне.
  - **Темная:** Белый QR-код на черном фоне.
- **Диалоговый режим:** Бот использует машину состояний (`FSMContext`) для пошагового взаимодействия с пользователем.
- **Простота использования:** Интуитивно понятный интерфейс, управляемый командами и кнопками.

## Технологический стек

- **Python 3**
- **aiogram 3.x:** Асинхронный фреймворк для создания Telegram-ботов.
- **qrcode:** Библиотека для генерации QR-кодов.
- **Pillow:** Библиотека для работы с изображениями, используется `qrcode`.
- **python-dotenv:** Для управления переменными окружения (например, токеном бота).
- **opencv-python-headless:** Библиотека для компьютерного зрения, используется для обработки изображений.
- **pyzbar:** Библиотека для чтения штрих-кодов и QR-кодов.

## Развертывание на VPS (на примере Ubuntu)

### 1. Подготовка сервера

Подключитесь к вашему VPS по SSH и обновите списки пакетов:

```bash
sudo apt update
sudo apt upgrade -y
```

### 2. Установка Python и зависимостей

Установите Python, `pip` и `venv` для создания виртуальных окружений:

```bash
sudo apt install python3 python3-pip python3-venv -y
```

### 3. Клонирование проекта

Склонируйте репозиторий с проектом на ваш сервер:

```bash
git clone <URL_вашего_репозитория>
cd <название_папки_проекта>
```

### 4. Настройка виртуального окружения

Создайте и активируйте виртуальное окружение:

```bash
python3 -m venv .venv
source .venv/bin/activate
```

### 5. Установка зависимостей

Установите все необходимые библиотеки из файла `requirements.txt`:

```bash
pip install -r requirements.txt
```

### 6. Настройка переменных окружения

Создайте файл `.env` на основе `.env.example` и внесите в него актуальные параметры.

```bash
cp .env.example .env
nano .env
```

В файле `.env` замените `YOUR_BOT_TOKEN_HERE` на реальный токен, полученный от [@BotFather](https://t.me/BotFather), и `YOUR_CHANNEL_ID_HERE` на ID целевого канала (например, `-1001234567890`). ID канала можно получить, переслав любое сообщение из него боту типа [@get_id_bot](https://t.me/get_id_bot):

```
TELEGRAM_BOT_TOKEN=ВАШ_ТОКЕН
TARGET_CHANNEL_ID=ВАШ_ID_КАНАЛА
```

Сохраните файл, нажав `Ctrl+X`, затем `Y` и `Enter`.

### 7. Запуск бота

Теперь вы можете запустить бота напрямую для проверки:

```bash
python3 main.py
```

Если все настроено правильно, бот начнет работать. Вы можете остановить его, нажав `Ctrl+C`.

### 8. (Рекомендуется) Настройка systemd для автозапуска

Чтобы бот работал постоянно и автоматически перезапускался в случае сбоев, рекомендуется настроить его как сервис `systemd`.

Создайте файл сервиса:

```bash
sudo nano /etc/systemd/system/qr-bot.service
```

Вставьте в него следующую конфигурацию. **Обязательно** замените `/path/to/your/project` на полный путь к папке вашего проекта и `your_user` на ваше имя пользователя на VPS. Убедитесь, что `ExecStart` указывает на `main.py`.

```ini
[Unit]
Description=Telegram QR Code Bot
After=network.target

[Service]
User=your_user
Group=your_user
WorkingDirectory=/path/to/your/project
ExecStart=/path/to/your/project/.venv/bin/python3 /path/to/your/project/main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

Сохраните и закройте файл.

Теперь включите и запустите сервис:

```bash
sudo systemctl enable qr-bot.service
sudo systemctl start qr-bot.service
```

Проверить статус сервиса можно командой:

```bash
sudo systemctl status qr-bot.service
```

Бот готов к работе!